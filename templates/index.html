{% extends "base.html" %}
{% load static %}

{% block title %}URL ë¶„ì„ - Link Shield{% endblock %}

{% block content %}
<div class="hero-section">
    <h1 class="hero-title">URL ë³´ì•ˆ ë¶„ì„</h1>
    <p class="hero-subtitle">ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë§í¬ë¥¼ ì•ˆì „í•˜ê²Œ ë¶„ì„í•©ë‹ˆë‹¤</p>
</div>

<div class="card main-card">
    <form id="analysisForm" class="analysis-form">
        {% csrf_token %}

        <div class="form-group">
            <label for="url" class="form-label">
                <span class="label-icon">ğŸ”—</span>
                ë¶„ì„í•  URLì„ ì…ë ¥í•˜ì„¸ìš”
            </label>
            <input
                type="url"
                id="url"
                name="url"
                class="form-input"
                placeholder="https://example.com"
                required
                autocomplete="off"
            >
            <div class="input-hint">â€» http:// ë˜ëŠ” https://ë¥¼ í¬í•¨í•œ ì „ì²´ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
        </div>

        <button type="submit" class="submit-btn">
            <span class="btn-icon">ğŸ”</span>
            <span>ì§€ê¸ˆ ë¶„ì„í•˜ê¸°</span>
            <span class="btn-arrow">â†’</span>
        </button>
    </form>
</div>

<div class="info-grid">
    <div class="info-card">
        <div class="info-icon">ğŸ“¸</div>
        <h3>ìŠ¤í¬ë¦°ìƒ·</h3>
        <p>í˜ì´ì§€ë¥¼ ì•ˆì „í•˜ê²Œ ë Œë”ë§í•˜ì—¬ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì œê³µí•©ë‹ˆë‹¤</p>
    </div>

    <div class="info-card">
        <div class="info-icon">ğŸ”„</div>
        <h3>ë¦¬ë‹¤ì´ë ‰ì…˜</h3>
        <p>ëª¨ë“  ë¦¬ë‹¤ì´ë ‰ì…˜ ê²½ë¡œë¥¼ ì¶”ì í•˜ì—¬ ìµœì¢… ë„ì°©ì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤</p>
    </div>

    <div class="info-card">
        <div class="info-icon">âš¡</div>
        <h3>ë™ì  ë¶„ì„</h3>
        <p>JavaScript ì‹¤í–‰ê³¼ ë„¤íŠ¸ì›Œí¬ í™œë™ì„ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤</p>
    </div>

    <div class="info-card">
        <div class="info-icon">ğŸŒ</div>
        <h3>ì„œë²„ ë¶„ì„</h3>
        <p>í˜¸ìŠ¤íŠ¸ ì„œë²„ì˜ ì •ë³´ì™€ ê³µê°œ í¬íŠ¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤</p>
    </div>
</div>

<!-- ìƒ˜í”Œ URL ì„¹ì…˜ -->
<div class="samples-section">
    <h2 class="samples-title">ğŸ“Œ ìƒ˜í”Œ URL ë‘˜ëŸ¬ë³´ê¸°</h2>
    <p class="samples-subtitle">í´ë¦­í•˜ë©´ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤</p>

    <div class="samples-grid">
        <!-- ë°•ìŠ¤ 1: Aì˜ˆì‹œ (í•˜ë“œì½”ë”©) -->
        <div class="sample-box">
            <div class="sample-header">
                <h3>ğŸ”µ Aì˜ˆì‹œ</h3>
                <span class="sample-badge">ì¼ë°˜ ì›¹ì‚¬ì´íŠ¸</span>
            </div>
            <div class="sample-list">
                <button type="button" class="sample-item" onclick="fillURL('https://www.google.com')">
                    <span class="sample-icon">ğŸŒ</span>
                    <span class="sample-url">google.com</span>
                </button>
                <button type="button" class="sample-item" onclick="fillURL('https://www.naver.com')">
                    <span class="sample-icon">ğŸŒ</span>
                    <span class="sample-url">naver.com</span>
                </button>
                <button type="button" class="sample-item" onclick="fillURL('https://www.youtube.com')">
                    <span class="sample-icon">ğŸ¥</span>
                    <span class="sample-url">youtube.com</span>
                </button>
                <button type="button" class="sample-item" onclick="fillURL('https://github.com')">
                    <span class="sample-icon">ğŸ’»</span>
                    <span class="sample-url">github.com</span>
                </button>
                <button type="button" class="sample-item" onclick="fillURL('https://www.amazon.com')">
                    <span class="sample-icon">ğŸ›’</span>
                    <span class="sample-url">amazon.com</span>
                </button>
                <button type="button" class="sample-item" onclick="fillURL('https://stackoverflow.com')">
                    <span class="sample-icon">ğŸ’¡</span>
                    <span class="sample-url">stackoverflow.com</span>
                </button>
                <button type="button" class="sample-item" onclick="fillURL('https://www.wikipedia.org')">
                    <span class="sample-icon">ğŸ“š</span>
                    <span class="sample-url">wikipedia.org</span>
                </button>
                <button type="button" class="sample-item" onclick="fillURL('https://www.reddit.com')">
                    <span class="sample-icon">ğŸ’¬</span>
                    <span class="sample-url">reddit.com</span>
                </button>
                <button type="button" class="sample-item" onclick="fillURL('https://www.twitter.com')">
                    <span class="sample-icon">ğŸ¦</span>
                    <span class="sample-url">twitter.com</span>
                </button>
                <button type="button" class="sample-item" onclick="fillURL('https://www.linkedin.com')">
                    <span class="sample-icon">ğŸ’¼</span>
                    <span class="sample-url">linkedin.com</span>
                </button>
            </div>
        </div>

        <!-- ë°•ìŠ¤ 2: Bì˜ˆì‹œ (API ì—°ë™ ì¤€ë¹„) -->
        <div class="sample-box">
            <div class="sample-header">
                <h3>ğŸŸ¢ Bì˜ˆì‹œ</h3>
                <span class="sample-badge">API ì—°ë™ ì˜ˆì •</span>
            </div>
            <div class="sample-list" id="sampleBoxB">
                <div class="sample-placeholder">
                    <span class="placeholder-icon">ğŸ”„</span>
                    <p>API ì—°ë™ í›„ ìƒ˜í”Œì´ í‘œì‹œë©ë‹ˆë‹¤</p>
                </div>
            </div>
        </div>

        <!-- ë°•ìŠ¤ 3: Cì˜ˆì‹œ (API ì—°ë™ ì¤€ë¹„) -->
        <div class="sample-box">
            <div class="sample-header">
                <h3>ğŸŸ¡ Cì˜ˆì‹œ</h3>
                <span class="sample-badge">API ì—°ë™ ì˜ˆì •</span>
            </div>
            <div class="sample-list" id="sampleBoxC">
                <div class="sample-placeholder">
                    <span class="placeholder-icon">ğŸ”„</span>
                    <p>API ì—°ë™ í›„ ìƒ˜í”Œì´ í‘œì‹œë©ë‹ˆë‹¤</p>
                </div>
            </div>
        </div>

        <!-- ë°•ìŠ¤ 4: ìµœê·¼ ë¶„ì„ URL (DB ì—°ë™) -->
        <div class="sample-box">
            <div class="sample-header">
                <h3>ğŸŸ£ ìµœê·¼ ë¶„ì„ URL</h3>
                <span class="sample-badge">ìµœì‹  10ê°œ</span>
            </div>
            <div class="sample-list" id="recentURLs">
                {% if recent_urls %}
                    {% for item in recent_urls %}
                    <button type="button" class="sample-item" onclick="fillURL('{{ item.original_url }}')">
                        <span class="sample-icon">
                            <img src="https://www.google.com/s2/favicons?domain={{ item.domain }}&sz=32"
                                 alt="icon"
                                 style="width: 18px; height: 18px;"
                                 onerror="this.style.display='none'; this.parentElement.textContent='ğŸŒ';">
                        </span>
                        <span class="sample-url">{{ item.domain }}</span>
                    </button>
                    {% endfor %}
                {% else %}
                    <div class="sample-placeholder">
                        <span class="placeholder-icon">ğŸ’¾</span>
                        <p>ë¶„ì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="warning-box">
    <div class="warning-icon">âš ï¸</div>
    <div class="warning-content">
        <h4>ì£¼ì˜ì‚¬í•­</h4>
        <p>ë³¸ ì„œë¹„ìŠ¤ëŠ” êµìœ¡ ëª©ì ì˜ í¬íŠ¸í´ë¦¬ì˜¤ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. ì‹¤ì œ ë³´ì•ˆ ìœ„í˜‘ì„ 100% íƒì§€í•˜ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// CSRF í† í° ê°€ì ¸ì˜¤ê¸°
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// URL ì…ë ¥ í•„ë“œì— ìë™ ì…ë ¥ í•¨ìˆ˜
function fillURL(url) {
    const urlInput = document.getElementById('url');
    urlInput.value = url;

    urlInput.scrollIntoView({ behavior: 'smooth', block: 'center' });

    urlInput.style.transition = 'all 0.3s ease';
    urlInput.style.borderColor = '#667eea';
    urlInput.style.boxShadow = '0 0 0 4px rgba(102, 126, 234, 0.2)';

    setTimeout(() => {
        urlInput.style.borderColor = '';
        urlInput.style.boxShadow = '';
    }, 1500);
}

// í¼ ì œì¶œ ì²˜ë¦¬ (API í˜¸ì¶œ)
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('analysisForm');
    const submitBtn = form.querySelector('.submit-btn');
    const urlInput = document.getElementById('url');

    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        const url = urlInput.value.trim();

        if (!url) {
            alert('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        // ë¡œë”© ìƒíƒœ
        const originalHTML = submitBtn.innerHTML;
        submitBtn.innerHTML = '<span class="spinner"></span><span>ë¶„ì„ ì¤‘...</span>';
        submitBtn.disabled = true;

        try {
            // API í˜¸ì¶œ
            const response = await fetch('/api/analyze/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ url: url })
            });

            const data = await response.json();

            if (response.ok) {
                // ì„±ê³µ: ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = `/result/${data.id}/`;
            } else {
                // ì—ëŸ¬ ì²˜ë¦¬
                alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                submitBtn.innerHTML = originalHTML;
                submitBtn.disabled = false;
            }
        } catch (error) {
            console.error('Error:', error);
            alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            submitBtn.innerHTML = originalHTML;
            submitBtn.disabled = false;
        }
    });

    // íŒŒë¹„ì½˜ ì ìš©
    const sampleItems = document.querySelectorAll('.sample-item');
    sampleItems.forEach(item => {
        const urlText = item.querySelector('.sample-url')?.textContent;
        const iconElement = item.querySelector('.sample-icon');

        if (urlText && iconElement && !iconElement.querySelector('img')) {
            const faviconUrl = `https://www.google.com/s2/favicons?domain=${urlText}&sz=32`;
            iconElement.innerHTML = `<img src="${faviconUrl}" alt="icon" style="width: 18px; height: 18px;" onerror="this.style.display='none'; this.parentElement.textContent='ğŸŒ';">`;
        }
    });
});
</script>
{% endblock %}